# 字体渲染参数调整指南

## 概述

字体渲染的质量和一致性可以通过调整 `src/font/glyph.zig` 中的 `RenderParams` 结构体中的参数来优化。

## 可调整参数

### 1. `msdf_range` (MSDF范围)

**位置**：`src/font/glyph.zig` 第19行

**作用**：控制边缘平滑过渡的范围（单位：像素）

**推荐范围**：0.5 - 1.0

**调整建议**：
- **较小值（0.5-0.6）**：
  - ✅ 更精确的边缘检测
  - ✅ 笔画更清晰，减少过度平滑
  - ✅ 适合修复笔画粗细不均匀
  - ⚠️ 边缘可能略硬

- **中等值（0.6-0.8）**：
  - ✅ 平衡清晰度和平滑度
  - ✅ 推荐用于大多数情况

- **较大值（0.8-1.0）**：
  - ✅ 更平滑的边缘
  - ⚠️ 可能过度平滑导致笔画变粗
  - ⚠️ 可能导致笔画粗细不均匀

**当前值**：`0.6`（推荐用于修复笔画粗细不均匀）

### 2. `edge_coverage` (边缘覆盖度)

**位置**：`src/font/glyph.zig` 第25行

**作用**：边缘像素的最小覆盖度

**推荐范围**：0.6 - 0.9

**调整建议**：
- **较小值（0.6-0.7）**：
  - ✅ 边缘更柔和
  - ⚠️ 可能模糊，笔画不够清晰

- **中等值（0.7-0.8）**：
  - ✅ 平衡清晰度和柔和度
  - ✅ 推荐用于大多数情况

- **较大值（0.8-0.9）**：
  - ✅ 边缘更清晰，笔画更粗
  - ✅ 适合需要更清晰字体的场景
  - ⚠️ 可能使笔画看起来过粗

**当前值**：`0.8`（推荐用于清晰的字体渲染）

### 3. `enable_hinting` (启用Hinting)

**位置**：`src/font/glyph.zig` 第30行

**作用**：是否启用字体Hinting（坐标对齐到像素网格）

**可选值**：`true` 或 `false`

**调整建议**：
- **`false`（禁用）**：
  - ✅ 保持原始坐标精度
  - ✅ 确保笔画粗细一致（推荐）
  - ✅ 避免对齐导致的不一致
  - ⚠️ 小字体可能略模糊

- **`true`（启用）**：
  - ✅ 提高小字体清晰度
  - ⚠️ 可能导致笔画粗细不均匀
  - ⚠️ 不同位置可能对齐到不同像素边界

**当前值**：`false`（推荐用于修复笔画粗细不均匀）

## 参数组合建议

### 组合1：清晰且一致（当前配置，推荐）
```zig
const msdf_range: f32 = 0.6;
const edge_coverage: f32 = 0.8;
const enable_hinting: bool = false;
```
**特点**：笔画清晰、粗细一致，适合大多数场景

### 组合2：更清晰
```zig
const msdf_range: f32 = 0.5;
const edge_coverage: f32 = 0.85;
const enable_hinting: bool = false;
```
**特点**：边缘更清晰，笔画更粗，适合需要高清晰度的场景

### 组合3：更柔和
```zig
const msdf_range: f32 = 0.7;
const edge_coverage: f32 = 0.75;
const enable_hinting: bool = false;
```
**特点**：边缘更平滑，适合需要柔和效果的场景

### 组合4：小字体优化（启用Hinting）
```zig
const msdf_range: f32 = 0.6;
const edge_coverage: f32 = 0.8;
const enable_hinting: bool = true;
```
**特点**：小字体更清晰，但可能略有粗细不均匀

## 调整步骤

1. **打开文件**：`src/font/glyph.zig`
2. **找到 `RenderParams` 结构体**（约第14-31行）
3. **修改参数值**
4. **保存文件**
5. **重新编译**：`zig build`
6. **测试效果**：运行程序查看渲染效果
7. **根据效果微调**：重复步骤3-6直到满意

## 注意事项

1. **参数相互影响**：调整一个参数可能影响其他参数的效果
2. **测试不同字体**：不同字体可能需要不同的参数组合
3. **测试不同大小**：小字体和大字体可能需要不同的参数
4. **保持一致性**：确保相同位置总是产生相同的覆盖度

## 故障排除

### 问题：笔画仍然粗细不均匀
- **尝试**：减小 `msdf_range`（如 0.5）
- **尝试**：确保 `enable_hinting` 为 `false`
- **检查**：确认覆盖度计算使用统一的距离场

### 问题：字体太模糊
- **尝试**：增大 `edge_coverage`（如 0.85）
- **尝试**：减小 `msdf_range`（如 0.5）

### 问题：字体太粗
- **尝试**：减小 `edge_coverage`（如 0.75）
- **尝试**：增大 `msdf_range`（如 0.7）

### 问题：边缘太硬
- **尝试**：增大 `msdf_range`（如 0.8）
- **尝试**：减小 `edge_coverage`（如 0.7）

## 更新日志

- 2024-XX-XX：创建参数调整指南
- 当前配置：`msdf_range=0.6`, `edge_coverage=0.8`, `enable_hinting=false`

