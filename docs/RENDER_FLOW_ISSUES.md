# æ¸²æŸ“æµç¨‹é—®é¢˜åˆ†ææŠ¥å‘Š

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†ZBrowseræ¸²æŸ“æµç¨‹ä¸­å‘ç°çš„é—®é¢˜ç‚¹ï¼ŒåŒ…æ‹¬æ€§èƒ½é—®é¢˜ã€æ¶æ„é—®é¢˜ã€åŠŸèƒ½ç¼ºå¤±å’Œä»£ç è´¨é‡é—®é¢˜ã€‚

## é—®é¢˜åˆ†ç±»

### ğŸ”´ ä¸¥é‡æ€§èƒ½é—®é¢˜ï¼ˆCritical Performance Issuesï¼‰

#### 1. æ ·å¼è®¡ç®—é‡å¤ï¼ˆrender-flow-1ï¼‰
**é—®é¢˜æè¿°**ï¼š
- åœ¨ `renderLayoutBox` ä¸­ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä¼šé‡æ–°è®¡ç®—æ ·å¼ï¼ˆè°ƒç”¨ `computeStyle`ï¼‰
- åœ¨ `buildLayoutTree` é˜¶æ®µå·²ç»è®¡ç®—è¿‡æ ·å¼ï¼Œä½†æ¸²æŸ“é˜¶æ®µåˆé‡æ–°è®¡ç®—
- å¯¼è‡´åŒä¸€ä¸ªèŠ‚ç‚¹çš„æ ·å¼è¢«è®¡ç®—å¤šæ¬¡ï¼Œæµªè´¹CPUèµ„æº

**å½±å“èŒƒå›´**ï¼š
- æ¯ä¸ªæ¸²æŸ“çš„å…ƒç´ éƒ½ä¼šé‡å¤è®¡ç®—æ ·å¼
- å¯¹äºæœ‰Nä¸ªå…ƒç´ çš„é¡µé¢ï¼Œæ ·å¼è®¡ç®—æ¬¡æ•° = Nï¼ˆå¸ƒå±€é˜¶æ®µï¼‰+ Nï¼ˆæ¸²æŸ“é˜¶æ®µï¼‰= 2Næ¬¡

**ä»£ç ä½ç½®**ï¼š
```56:59:src/render/renderer.zig
        // è®¡ç®—æ ·å¼ï¼ˆç”¨äºè·å–é¢œè‰²ã€èƒŒæ™¯ç­‰ï¼‰
        var cascade_engine = cascade.Cascade.init(self.allocator);
        var computed_style = try cascade_engine.computeStyle(layout_box.node, self.stylesheets);
        defer computed_style.deinit();
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨ `buildLayoutTree` é˜¶æ®µå°† `ComputedStyle` ä¿å­˜åˆ° `LayoutBox` ä¸­
2. æ¸²æŸ“é˜¶æ®µç›´æ¥ä» `LayoutBox` è·å–å·²è®¡ç®—çš„æ ·å¼ï¼Œä¸å†é‡æ–°è®¡ç®—
3. éœ€è¦ä¿®æ”¹ `LayoutBox` ç»“æ„ï¼Œæ·»åŠ  `computed_style` å­—æ®µ

**ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜

---

#### 2. æ–‡æœ¬èŠ‚ç‚¹æ ·å¼è®¡ç®—é‡å¤ï¼ˆrender-flow-2ï¼‰
**é—®é¢˜æè¿°**ï¼š
- åœ¨ `renderContent` ä¸­ï¼Œæ–‡æœ¬èŠ‚ç‚¹ä¼šé‡æ–°è®¡ç®—çˆ¶å…ƒç´ çš„æ ·å¼
- çˆ¶å…ƒç´ çš„æ ·å¼åœ¨å¸ƒå±€é˜¶æ®µå·²ç»è®¡ç®—è¿‡ï¼Œè¿™é‡Œåˆé‡å¤è®¡ç®—

**å½±å“èŒƒå›´**ï¼š
- æ¯ä¸ªæ–‡æœ¬èŠ‚ç‚¹éƒ½ä¼šé‡æ–°è®¡ç®—çˆ¶å…ƒç´ æ ·å¼
- å¯¹äºæœ‰Mä¸ªæ–‡æœ¬èŠ‚ç‚¹çš„é¡µé¢ï¼Œé¢å¤–è®¡ç®—Mæ¬¡çˆ¶å…ƒç´ æ ·å¼

**ä»£ç ä½ç½®**ï¼š
```407:423:src/render/renderer.zig
            if (layout_box.parent) |parent| {
                // é‡æ–°è®¡ç®—çˆ¶å…ƒç´ çš„æ ·å¼ï¼ˆç”¨äºæ–‡æœ¬èŠ‚ç‚¹ç»§æ‰¿ï¼‰
                var cascade_engine = cascade.Cascade.init(self.allocator);
                var parent_computed_style = try cascade_engine.computeStyle(parent.node, self.stylesheets);

                // æ£€æŸ¥å½“å‰æ ·å¼æ˜¯å¦æœ‰colorå±æ€§ï¼ˆæ–‡æœ¬èŠ‚ç‚¹æœ€é‡è¦çš„å±æ€§ï¼‰
                // å¦‚æœæ²¡æœ‰colorå±æ€§ï¼Œä½¿ç”¨çˆ¶å…ƒç´ çš„æ ·å¼
                // æ–‡æœ¬èŠ‚ç‚¹åº”è¯¥æ€»æ˜¯ç»§æ‰¿çˆ¶å…ƒç´ çš„æ ·å¼ï¼Œç‰¹åˆ«æ˜¯colorå±æ€§
                if (computed_style.getProperty("color") == null) {
                    parent_computed_style_opt = parent_computed_style;
                    // æ³¨æ„ï¼šå¿…é¡»ä½¿ç”¨parent_computed_style_optçš„åœ°å€ï¼Œè€Œä¸æ˜¯parent_computed_styleçš„åœ°å€
                    // å› ä¸ºparent_computed_styleåœ¨ifå—ç»“æŸåä¼šè¢«é”€æ¯
                    text_computed_style = &parent_computed_style_opt.?;
                } else {
                    parent_computed_style.deinit();
                }
            }
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. çˆ¶å…ƒç´ çš„æ ·å¼å·²ç»ä¿å­˜åœ¨ `parent.computed_style` ä¸­ï¼ˆå¦‚æœå®ç°äº†render-flow-1ï¼‰
2. ç›´æ¥ä» `parent.computed_style` è·å–ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—

**ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜

---

### ğŸŸ¡ æ€§èƒ½ä¼˜åŒ–ï¼ˆPerformance Optimizationï¼‰

#### 3. æ ·å¼è®¡ç®—ç¼“å­˜ç¼ºå¤±ï¼ˆrender-flow-3ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰æ²¡æœ‰æ ·å¼è®¡ç®—ç¼“å­˜æœºåˆ¶
- å¦‚æœåŒä¸€ä¸ªèŠ‚ç‚¹è¢«å¤šæ¬¡è®¿é—®ï¼ˆä¾‹å¦‚åœ¨å¸ƒå±€å’Œæ¸²æŸ“é˜¶æ®µï¼‰ï¼Œä¼šé‡å¤è®¡ç®—æ ·å¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç° `ComputedStyle` ç¼“å­˜æœºåˆ¶
- ä½¿ç”¨ `HashMap` ç¼“å­˜ï¼ˆ`NodeæŒ‡é’ˆ -> ComputedStyle`ï¼‰
- åœ¨ `Cascade` å¼•æ“ä¸­æ·»åŠ ç¼“å­˜åŠŸèƒ½

**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

---

#### 4. Cascadeå¼•æ“æœªå¤ç”¨ï¼ˆrender-flow-4ï¼‰
**é—®é¢˜æè¿°**ï¼š
- åœ¨æ¸²æŸ“é˜¶æ®µï¼Œæ¯ä¸ªå…ƒç´ éƒ½åˆ›å»ºæ–°çš„ `Cascade` å®ä¾‹
- `Cascade` å®ä¾‹æœ¬èº«æ²¡æœ‰çŠ¶æ€ï¼Œå¯ä»¥å¤ç”¨

**ä»£ç ä½ç½®**ï¼š
```56:57:src/render/renderer.zig
        var cascade_engine = cascade.Cascade.init(self.allocator);
        var computed_style = try cascade_engine.computeStyle(layout_box.node, self.stylesheets);
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å°† `Cascade` å®ä¾‹ä½œä¸º `Renderer` çš„æˆå‘˜å˜é‡
- åœ¨ `Renderer.init` æ—¶åˆ›å»ºä¸€æ¬¡ï¼Œåç»­å¤ç”¨

**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

---

#### 5. å¸ƒå±€æ ‘æœªå¤ç”¨ï¼ˆrender-flow-9ï¼‰
**é—®é¢˜æè¿°**ï¼š
- æ¯æ¬¡è°ƒç”¨ `render` éƒ½é‡æ–°æ„å»ºå¸ƒå±€æ ‘
- å¦‚æœDOMæœªå˜åŒ–ï¼Œåº”è¯¥å¤ç”¨ä¹‹å‰çš„å¸ƒå±€æ ‘

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨ `Browser` ä¸­ç¼“å­˜å¸ƒå±€æ ‘
- æ£€æµ‹DOMå˜åŒ–ï¼Œåªåœ¨DOMå˜åŒ–æ—¶é‡æ–°æ„å»ºå¸ƒå±€æ ‘
- å®ç°å¢é‡æ›´æ–°æœºåˆ¶

**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

---

#### 6. æ–‡æœ¬å®½åº¦è®¡ç®—é‡å¤ï¼ˆrender-flow-16ï¼‰
**é—®é¢˜æè¿°**ï¼š
- åœ¨ `renderContent` ä¸­ï¼ŒåŒä¸€æ®µæ–‡æœ¬çš„å®½åº¦è¢«è®¡ç®—å¤šæ¬¡
- ä¾‹å¦‚ï¼štext-alignè®¡ç®—æ—¶è®¡ç®—ä¸€æ¬¡ï¼Œtext-decorationè®¡ç®—æ—¶åˆè®¡ç®—ä¸€æ¬¡

**ä»£ç ä½ç½®**ï¼š
```439:440:src/render/renderer.zig
                    const text_end_x = try self.render_backend.calculateTextWidth(transformed_text, rect.x, font);
                    const text_width = text_end_x - rect.x;
```
å’Œ
```519:520:src/render/renderer.zig
                    const text_end_x = try self.render_backend.calculateTextWidth(transformed_text, text_x, font);
                    const text_width = text_end_x - text_x;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è®¡ç®—ä¸€æ¬¡æ–‡æœ¬å®½åº¦ï¼Œç¼“å­˜ç»“æœ
- åœ¨éœ€è¦çš„åœ°æ–¹å¤ç”¨

**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

---

### ğŸŸ  æ¶æ„é—®é¢˜ï¼ˆArchitecture Issuesï¼‰

#### 7. æ ·å¼è®¡ç®—ä½ç½®æ··ä¹±ï¼ˆrender-flow-5ï¼‰
**é—®é¢˜æè¿°**ï¼š
- æ ·å¼è®¡ç®—åœ¨ `buildLayoutTree` å’Œ `renderLayoutBox` ä¸¤ä¸ªåœ°æ–¹è¿›è¡Œ
- è¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œåº”è¯¥ç»Ÿä¸€åœ¨å¸ƒå±€é˜¶æ®µå®Œæˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç»Ÿä¸€åœ¨ `buildLayoutTree` é˜¶æ®µå®Œæˆæ‰€æœ‰æ ·å¼è®¡ç®—
- æ¸²æŸ“é˜¶æ®µåªä½¿ç”¨å·²è®¡ç®—çš„æ ·å¼ï¼Œä¸å†è®¡ç®—

**ä¼˜å…ˆçº§**ï¼šğŸŸ  ä¸­é«˜

---

#### 8. æ¸²æŸ“é¡ºåºç¡¬ç¼–ç ï¼ˆrender-flow-17ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰æ¸²æŸ“é¡ºåºï¼ˆé˜´å½±->èƒŒæ™¯->å­å…ƒç´ ->æ–‡æœ¬->è¾¹æ¡†ï¼‰æ˜¯ç¡¬ç¼–ç çš„
- åº”è¯¥æ ¹æ®CSSè§„èŒƒåŠ¨æ€ç¡®å®šæ¸²æŸ“é¡ºåº

**ä»£ç ä½ç½®**ï¼š
```84:177:src/render/renderer.zig
        // 1. åº”ç”¨opacity
        // 2. ç»˜åˆ¶é˜´å½±
        // 3. ç»˜åˆ¶èƒŒæ™¯
        // 4. å¤„ç†overflowè£å‰ª
        // 5. é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹
        // 6. ç»˜åˆ¶å†…å®¹ï¼ˆæ–‡æœ¬ï¼‰
        // 7. ç»˜åˆ¶è¾¹æ¡†
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ ¹æ®CSSè§„èŒƒå®šä¹‰æ¸²æŸ“é¡ºåºè§„åˆ™
- å®ç°åŠ¨æ€æ¸²æŸ“é¡ºåºç¡®å®šæœºåˆ¶

**ä¼˜å…ˆçº§**ï¼šğŸŸ  ä½

---

### ğŸ”µ åŠŸèƒ½ç¼ºå¤±ï¼ˆMissing Featuresï¼‰

#### 9. z-indexæ¸²æŸ“é¡ºåºä¸æ­£ç¡®ï¼ˆrender-flow-6ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰å®ç°å…ˆæ¸²æŸ“æ™®é€šå…ƒç´ ï¼Œå†æ¸²æŸ“positionedå…ƒç´ ï¼ˆæŒ‰z-indexæ’åºï¼‰
- ä¸ç¬¦åˆCSSè§„èŒƒï¼Œåº”è¯¥æŒ‰z-indexå€¼æ··åˆæ’åº

**ä»£ç ä½ç½®**ï¼š
```157:165:src/render/renderer.zig
        // åˆå¹¶æ’åºåçš„positionedå…ƒç´ åˆ°æ¸²æŸ“åˆ—è¡¨
        // ç®€åŒ–å®ç°ï¼šå…ˆæ¸²æŸ“æ™®é€šå…ƒç´ ï¼Œå†æ¸²æŸ“positionedå…ƒç´ ï¼ˆæŒ‰z-indexæ’åºï¼‰
        // TODO: å®Œæ•´å®ç°éœ€è¦æŒ‰ç…§z-indexå€¼æ··åˆæ¸²æŸ“é¡ºåº
        for (children_to_render.items) |child| {
            try self.renderLayoutBox(child);
        }
        for (positioned_children.items) |child| {
            try self.renderLayoutBox(child);
        }
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å°†æ‰€æœ‰å­å…ƒç´ ï¼ˆåŒ…æ‹¬æ™®é€šå…ƒç´ å’Œpositionedå…ƒç´ ï¼‰æŒ‰z-indexå€¼ç»Ÿä¸€æ’åº
- ç›¸åŒz-indexçš„å…ƒç´ æŒ‰DOMé¡ºåºæ’åº

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä¸­

---

#### 10. èƒŒæ™¯å›¾ç‰‡æœªå®ç°ï¼ˆrender-flow-10ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰åªæ”¯æŒ `background-color`ï¼Œä¸æ”¯æŒ `background-image`
- éœ€è¦å®ç°å›¾ç‰‡åŠ è½½å’Œæ¸²æŸ“åŠŸèƒ½

**ä»£ç ä½ç½®**ï¼š
```281:297:src/render/renderer.zig
    /// æ¸²æŸ“èƒŒæ™¯
    fn renderBackground(self: *Renderer, layout_box: *box.LayoutBox, computed_style: *const cascade.ComputedStyle, rect: backend.Rect) !void {
        // è·å–èƒŒæ™¯é¢œè‰²
        const bg_color = self.getBackgroundColor(computed_style);

        if (bg_color) |color| {
            // æ£€æŸ¥æ˜¯å¦æœ‰åœ†è§’
            if (layout_box.box_model.border_radius) |radius| {
                // ç»˜åˆ¶åœ†è§’èƒŒæ™¯
                self.drawRoundedRectPath(rect, radius);
                self.render_backend.fill(color);
            } else {
                // ç»˜åˆ¶æ™®é€šçŸ©å½¢èƒŒæ™¯
                self.render_backend.fillRect(rect, color);
            }
        }
    }
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°å›¾ç‰‡åŠ è½½æ¨¡å—ï¼ˆæ”¯æŒå¸¸è§å›¾ç‰‡æ ¼å¼ï¼šPNGã€JPEGã€GIFã€WebPç­‰ï¼‰
- åœ¨ `renderBackground` ä¸­æ£€æŸ¥ `background-image` å±æ€§
- å®ç°å›¾ç‰‡æ¸²æŸ“åŠŸèƒ½

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä½

---

#### 11. æ¸å˜èƒŒæ™¯æœªå®ç°ï¼ˆrender-flow-11ï¼‰
**é—®é¢˜æè¿°**ï¼š
- ä¸æ”¯æŒ `linear-gradient`ã€`radial-gradient` ç­‰CSSæ¸å˜
- éœ€è¦å®ç°æ¸å˜æ¸²æŸ“ç®—æ³•

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è§£ææ¸å˜è¯­æ³•ï¼ˆ`linear-gradient(...)`ã€`radial-gradient(...)`ï¼‰
- å®ç°æ¸å˜æ¸²æŸ“ç®—æ³•ï¼ˆçº¿æ€§æ’å€¼ã€å¾„å‘æ’å€¼ï¼‰

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä½

---

#### 12. box-shadowæ¨¡ç³Šæœªå®ç°ï¼ˆrender-flow-12ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰box-shadowå®ç°æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸æ”¯æŒbluræ•ˆæœ
- éœ€è¦å®ç°é«˜æ–¯æ¨¡ç³Šç®—æ³•

**ä»£ç ä½ç½®**ï¼š
```249:279:src/render/renderer.zig
    /// æ¸²æŸ“box-shadowé˜´å½±
    /// ç®€åŒ–å®ç°ï¼šä½¿ç”¨ç®€å•çš„çŸ©å½¢é˜´å½±ï¼Œä¸å®ç°æ¨¡ç³Šæ•ˆæœ
    /// TODO: å®Œæ•´å®ç°éœ€è¦å®ç°é«˜æ–¯æ¨¡ç³Šç®—æ³•
    fn renderBoxShadow(self: *Renderer, layout_box: *box.LayoutBox, shadow: box.BoxShadow, rect: backend.Rect) !void {
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°é«˜æ–¯æ¨¡ç³Šç®—æ³•ï¼ˆå¯ä»¥ä½¿ç”¨å¿«é€Ÿæ¨¡ç³Šç®—æ³•å¦‚Box Blurï¼‰
- å¯¹é˜´å½±åŒºåŸŸåº”ç”¨æ¨¡ç³Šæ•ˆæœ

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä¸­

---

#### 13. åœ†è§’è™šçº¿è¾¹æ¡†æœªå®ç°ï¼ˆrender-flow-13ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰åœ†è§’è™šçº¿è¾¹æ¡†ä½¿ç”¨å®çº¿ä»£æ›¿
- éœ€è¦å®ç°çœŸæ­£çš„åœ†è§’è™šçº¿è¾¹æ¡†ç»˜åˆ¶ç®—æ³•

**ä»£ç ä½ç½®**ï¼š
```333:340:src/render/renderer.zig
                    if (is_dashed) {
                        // TODO: åœ†è§’è™šçº¿è¾¹æ¡†éœ€è¦æ›´å¤æ‚çš„å®ç°
                        // å½“å‰ç®€åŒ–ï¼šä½¿ç”¨å®çº¿
                        self.render_backend.stroke(color, border_width);
                    } else {
                        self.render_backend.stroke(color, border_width);
                    }
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°åœ†è§’è·¯å¾„çš„è™šçº¿ç»˜åˆ¶ç®—æ³•
- æ²¿ç€åœ†è§’è·¯å¾„åˆ†æ®µç»˜åˆ¶è™šçº¿

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä½

---

#### 14. æ–‡æœ¬ä¸¤ç«¯å¯¹é½æœªå®ç°ï¼ˆrender-flow-14ï¼‰
**é—®é¢˜æè¿°**ï¼š
- `text-align: justify` å½“å‰æŒ‰å·¦å¯¹é½å¤„ç†
- éœ€è¦å®ç°å­—ç¬¦é—´è·è°ƒæ•´ç®—æ³•

**ä»£ç ä½ç½®**ï¼š
```456:460:src/render/renderer.zig
                        .justify => {
                            // ä¸¤ç«¯å¯¹é½ï¼ˆç®€åŒ–å®ç°ï¼šæš‚æ—¶æŒ‰å·¦å¯¹é½å¤„ç†ï¼‰
                            // TODO: å®Œæ•´å®ç°éœ€è¦è°ƒæ•´å­—ç¬¦é—´è·
                            text_x = rect.x;
                        },
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- è®¡ç®—æ–‡æœ¬å®½åº¦å’Œå®¹å™¨å®½åº¦çš„å·®å€¼
- å°†å·®å€¼å¹³å‡åˆ†é…åˆ°å­—ç¬¦é—´è·ä¸­
- ä½¿ç”¨è°ƒæ•´åçš„å­—ç¬¦é—´è·ç»˜åˆ¶æ–‡æœ¬

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä½

---

#### 15. å†…é˜´å½±æœªå®ç°ï¼ˆrender-flow-15ï¼‰
**é—®é¢˜æè¿°**ï¼š
- `box-shadow` çš„ `inset` æ¨¡å¼æœªå®ç°
- éœ€è¦å®ç°å†…é˜´å½±æ¸²æŸ“ç®—æ³•

**ä»£ç ä½ç½®**ï¼š
```252:257:src/render/renderer.zig
        // å¦‚æœæ˜¯å†…é˜´å½±ï¼ˆinsetï¼‰ï¼Œæš‚æ—¶ä¸å®ç°
        if (shadow.inset) {
            // TODO: å®ç°å†…é˜´å½±
            return;
        }
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°å†…é˜´å½±æ¸²æŸ“ç®—æ³•
- åœ¨å…ƒç´ å†…éƒ¨ç»˜åˆ¶é˜´å½±æ•ˆæœ

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä½

---

#### 16. overflow: scroll/autoæœªå®Œå…¨å®ç°ï¼ˆrender-flow-19ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å½“å‰åªå¤„ç† `overflow: hidden` çš„è£å‰ª
- `scroll` å’Œ `auto` éœ€è¦å®ç°æ»šåŠ¨æ¡æ¸²æŸ“ï¼ˆæˆ–è‡³å°‘æ­£ç¡®å¤„ç†è£å‰ªï¼‰

**ä»£ç ä½ç½®**ï¼š
```104:119:src/render/renderer.zig
        // 4. å¤„ç†overflowå±æ€§ï¼ˆå¦‚æœä¸ºhiddenã€scrollæˆ–autoï¼Œéœ€è¦è£å‰ªï¼‰
        const needs_clip = layout_box.overflow != .visible;
        if (needs_clip) {
            // ä¿å­˜å½“å‰çŠ¶æ€ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ä¿å­˜ï¼‰
            if (!needs_opacity) {
                self.render_backend.save();
            }
            // è®¾ç½®è£å‰ªåŒºåŸŸä¸ºå†…å®¹åŒºåŸŸï¼ˆåŒ…å«paddingï¼‰
            const clip_rect = backend.Rect.init(
                content_box_rect.x,
                content_box_rect.y,
                content_box_rect.width,
                content_box_rect.height,
            );
            self.render_backend.clip(clip_rect);
        }
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¯¹äº `scroll` å’Œ `auto`ï¼Œè‡³å°‘éœ€è¦æ­£ç¡®å®ç°è£å‰ª
- ç†æƒ³æƒ…å†µä¸‹åº”è¯¥å®ç°æ»šåŠ¨æ¡æ¸²æŸ“ï¼ˆä½†headlessæµè§ˆå™¨å¯èƒ½ä¸éœ€è¦ï¼‰

**ä¼˜å…ˆçº§**ï¼šğŸ”µ ä½

---

### ğŸŸ¢ ä»£ç è´¨é‡ï¼ˆCode Qualityï¼‰

#### 17. è°ƒè¯•è¾“å‡ºæœªç§»é™¤ï¼ˆrender-flow-7ï¼‰
**é—®é¢˜æè¿°**ï¼š
- å¤§é‡ `std.debug.print` è°ƒè¯•ä»£ç åº”è¯¥ç§»é™¤æˆ–ä½¿ç”¨æ¡ä»¶ç¼–è¯‘
- å½±å“ç”Ÿäº§ç¯å¢ƒæ€§èƒ½

**å½±å“èŒƒå›´**ï¼š
- `src/layout/block.zig` - å¤§é‡è°ƒè¯•è¾“å‡º
- `src/layout/style_utils.zig` - è°ƒè¯•è¾“å‡º
- `src/render/renderer.zig` - è°ƒè¯•è¾“å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ¡ä»¶ç¼–è¯‘ï¼ˆ`comptime` æˆ–ç¼–è¯‘é€‰é¡¹ï¼‰
- åªåœ¨debugæ¨¡å¼ä¸‹è¾“å‡ºè°ƒè¯•ä¿¡æ¯
- æˆ–å®Œå…¨ç§»é™¤è°ƒè¯•è¾“å‡º

**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä½

---

#### 18. ä¸´æ—¶ArrayListåˆ†é…ï¼ˆrender-flow-18ï¼‰
**é—®é¢˜æè¿°**ï¼š
- `renderLayoutBox` ä¸­ä¸ºz-indexæ’åºåˆ›å»ºä¸´æ—¶ `ArrayList`
- åº”è¯¥è€ƒè™‘ä½¿ç”¨æ ˆåˆ†é…æˆ–å¤ç”¨

**ä»£ç ä½ç½®**ï¼š
```124:146:src/render/renderer.zig
        var children_to_render = std.ArrayList(*box.LayoutBox){
            .items = &[_]*box.LayoutBox{},
            .capacity = 0,
        };
        defer children_to_render.deinit(self.allocator);
        
        // æ”¶é›†éœ€è¦æŒ‰z-indexæ’åºçš„å…ƒç´ å’Œæ™®é€šå…ƒç´ 
        var positioned_children = std.ArrayList(*box.LayoutBox){
            .items = &[_]*box.LayoutBox{},
            .capacity = 0,
        };
        defer positioned_children.deinit(self.allocator);
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ ˆåˆ†é…çš„æ•°ç»„ï¼ˆå¦‚æœå­å…ƒç´ æ•°é‡æœ‰é™ï¼‰
- æˆ–å¤ç”¨ `ArrayList`ï¼ˆä½œä¸º `Renderer` çš„æˆå‘˜ï¼‰

**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä½

---

#### 19. é”™è¯¯å¤„ç†æ£€æŸ¥ï¼ˆrender-flow-20ï¼‰
**é—®é¢˜æè¿°**ï¼š
- éœ€è¦æ£€æŸ¥ `renderLayoutBox` ä¸­æ‰€æœ‰é”™è¯¯è·¯å¾„æ˜¯å¦æ­£ç¡®é‡Šæ”¾èµ„æº
- ç¡®ä¿æ‰€æœ‰ `errdefer` å’Œ `defer` çš„ä½¿ç”¨æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®¡æŸ¥æ‰€æœ‰é”™è¯¯è·¯å¾„
- ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾
- æ·»åŠ æµ‹è¯•éªŒè¯é”™è¯¯è·¯å¾„

**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ ä¸­

---

## é—®é¢˜ç»Ÿè®¡

- ğŸ”´ ä¸¥é‡æ€§èƒ½é—®é¢˜ï¼š2ä¸ª
- ğŸŸ¡ æ€§èƒ½ä¼˜åŒ–ï¼š4ä¸ª
- ğŸŸ  æ¶æ„é—®é¢˜ï¼š2ä¸ª
- ğŸ”µ åŠŸèƒ½ç¼ºå¤±ï¼š8ä¸ª
- ğŸŸ¢ ä»£ç è´¨é‡ï¼š3ä¸ª

**æ€»è®¡**ï¼š19ä¸ªé—®é¢˜

## ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
1. render-flow-1: æ ·å¼è®¡ç®—é‡å¤ï¼ˆä¸¥é‡æ€§èƒ½é—®é¢˜ï¼‰
2. render-flow-2: æ–‡æœ¬èŠ‚ç‚¹æ ·å¼è®¡ç®—é‡å¤ï¼ˆä¸¥é‡æ€§èƒ½é—®é¢˜ï¼‰
3. render-flow-5: æ ·å¼è®¡ç®—ä½ç½®æ··ä¹±ï¼ˆæ¶æ„é—®é¢˜ï¼‰

### ç¬¬äºŒé˜¶æ®µï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
4. render-flow-3: æ ·å¼è®¡ç®—ç¼“å­˜
5. render-flow-4: Cascadeå¼•æ“å¤ç”¨
6. render-flow-6: z-indexæ¸²æŸ“é¡ºåº
7. render-flow-12: box-shadowæ¨¡ç³Š

### ç¬¬ä¸‰é˜¶æ®µï¼ˆä½ä¼˜å…ˆçº§ï¼‰
8. å…¶ä»–åŠŸèƒ½ç¼ºå¤±å’Œä»£ç è´¨é‡é—®é¢˜

## å®æ–½å»ºè®®

1. **å…ˆè§£å†³æ€§èƒ½é—®é¢˜**ï¼šæ ·å¼è®¡ç®—é‡å¤æ˜¯æœ€ä¸¥é‡çš„é—®é¢˜ï¼Œåº”è¯¥ä¼˜å…ˆè§£å†³
2. **ç»Ÿä¸€æ¶æ„**ï¼šå°†æ ·å¼è®¡ç®—ç»Ÿä¸€åˆ°å¸ƒå±€é˜¶æ®µï¼Œç®€åŒ–æ¸²æŸ“é˜¶æ®µé€»è¾‘
3. **é€æ­¥å®Œå–„åŠŸèƒ½**ï¼šåœ¨æ€§èƒ½é—®é¢˜è§£å†³åï¼Œé€æ­¥å®ç°ç¼ºå¤±çš„åŠŸèƒ½
4. **ä»£ç è´¨é‡æå‡**ï¼šæœ€åå¤„ç†ä»£ç è´¨é‡é—®é¢˜ï¼Œå¦‚ç§»é™¤è°ƒè¯•è¾“å‡ºç­‰

## å‚è€ƒ

- [æ¸²æŸ“æµç¨‹å›¾](RENDER_FLOW.md)
- [å¸ƒå±€è®¾è®¡æ–‡æ¡£](LAYOUT_DESIGN.md)
- [APIæ–‡æ¡£](API.md)



