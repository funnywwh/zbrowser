# Cursor AI开发规则 - Headless浏览器渲染引擎

## 项目概述
这是一个使用Zig 0.15.2从零开始实现的headless浏览器渲染引擎，支持HTML5、CSS3和现代JavaScript，输出PNG图片，0外部依赖。

## 开发规范

### 代码风格
- 使用`zig fmt`格式化所有代码
- 函数命名：camelCase
- 类型命名：PascalCase
- 常量命名：UPPER_SNAKE_CASE
- 所有公共API必须有文档注释（///）

### 内存管理
- 使用Zig的内存安全特性
- 明确所有权，避免内存泄漏
- 使用Arena分配器管理DOM节点生命周期
- 大对象使用GeneralPurposeAllocator

### 错误处理
- 使用Zig的错误处理机制（Error Union Types）
- 所有可能失败的操作必须返回错误
- 提供清晰的错误信息
- HTML/CSS解析要有容错机制

### 测试要求
- 每个公开函数必须有测试
- 边界条件必须有测试
- 错误情况必须有测试
- 目标：100%代码覆盖率
- 测试文件放在tests/目录，与src结构对应

### 模块组织
- 每个模块独立，接口清晰
- 避免循环依赖
- 使用Zig的模块系统（@import）

### Chrome兼容性
- 严格遵循Chrome最新版本规范
- 参考HTML5、CSS3、ECMAScript规范
- 渲染结果要与Chrome视觉一致
- 通过Chrome对比测试验证

### 性能要求
- 关键路径要优化
- 使用缓存减少重复计算
- 考虑使用SIMD优化图像处理

### 文档要求
- 复杂算法必须有注释
- 公共API必须有文档注释
- 使用Zig文档注释格式（///）

## 开发流程
1. 先写测试，再写实现（TDD）
2. 确保测试通过
3. 检查代码覆盖率
4. 运行zig fmt格式化
5. 检查linter错误

## 禁止事项
- 不要使用外部依赖（除Zig标准库）
- 不要硬编码魔法数字
- 不要忽略错误
- 不要跳过测试

